---
import Card from "../components/Card.astro";
import "../misc.css";
const friedmanquote = String.raw`“The important thing is to make it politically profitable for the wrong people to do the right thing. If it is not politically profitable for the wrong people to do the right thing, the right people will not do the right thing either.”`;
const painequote = String.raw`“Government, even in its best state, is but a necessary evil; in its worst state, an intolerable one.”`;
const bastiatquote = String.raw`“If the natural tendencies of mankind are so bad that it is not safe to permit people to be free, how is it that the tendencies of these organizers are always good? Do not the legislators and their appointed agents also belong to the human race?”`;
const hayekquote = String.raw`“The argument for liberty is not an argument against organization, which is one of the most powerful tools human reason can employ, but an argument against all exclusive, privileged, monopolistic organization, against the use of coercion to prevent others from doing better.”`;
const spoonerquote = String.raw`“But whether the Constitution really be one thing, or another, this much is certain - that it has either authorized such a government as we have had, or has been powerless to prevent it. In either case it is unfit to exist.”`;
const sowellquote = String.raw`“The fact that the market is not doing what we wish it would do is no reason to automatically assume that the government would do better.”`;
import friedman from "../assets/portraits/Milton-Friedman.jpg";
import spooner from "../assets/portraits/Lysander-Spooner.jpg";
import bastiat from "../assets/portraits/Frederic-Bastiat.jpg";
import paine from "../assets/portraits/Thomas-Paine.jpg";
import sowell from "../assets/portraits/Thomas-Sowell.jpg";
import hayek from "../assets/portraits/Friedrich-Hayek.jpg";
---

<section
  id="carousel"
  tabindex="0"
  class="noscrollbar overflow-x-scroll whitespace-nowrap py-10 flex cursor-grab active:cursor-grabbing"
>
  <h2 class="hidden">Quotes</h2>
  <Card
    number
    name="Lysander Spooner"
    imagepath={spooner}
    quote={spoonerquote}
    title="American Abolitionist"
  />
  <Card
    name="Milton Friedman"
    imagepath={friedman}
    quote={friedmanquote}
    title="1976 Nobel Laureate in Economics"
  />
  <Card
    name="Frederic Bastiat"
    imagepath={bastiat}
    quote={bastiatquote}
    title="French Economist and Lawmaker"
  />
  <Card
    name="Thomas Paine"
    imagepath={paine}
    quote={painequote}
    title="American Revolutionary"
  />
  <Card
    name="Thomas Sowell"
    imagepath={sowell}
    quote={sowellquote}
    title="American Economist and Author"
  />
  <Card
    name="Friedrich Hayek"
    imagepath={hayek}
    quote={hayekquote}
    title="1974 Nobel Laureate in Economics"
  />
</section>

<script>
  const carousel = document.getElementById("carousel");

  if (carousel instanceof HTMLElement) {
    let isDragging = false;
    let velocityX = 0;
    let lastClientX = 0;
    let lastTime = 0;
    let momentumFrame = 0;
    let previousBodyUserSelect = "";
    const textSelector =
      "p, span, blockquote, h1, h2, h3, h4, h5, h6, li, a, strong, em, small";

    const prefersReducedMotion = window.matchMedia(
      "(prefers-reduced-motion: reduce)",
    ).matches;
    carousel.style.touchAction = "pan-y";

    const stopMomentum = () => {
      if (momentumFrame) {
        cancelAnimationFrame(momentumFrame);
        momentumFrame = 0;
      }
    };

    const setCursorFromTarget = (target: EventTarget | null) => {
      if (isDragging) {
        carousel.style.cursor = "grabbing";
        return;
      }

      if (target instanceof Element && target.closest(textSelector)) {
        carousel.style.cursor = "text";
      } else {
        carousel.style.cursor = "grab";
      }
    };

    const startMomentum = () => {
      if (prefersReducedMotion) return;
      stopMomentum();

      const step = () => {
        if (Math.abs(velocityX) < 0.01) {
          momentumFrame = 0;
          return;
        }

        carousel.scrollLeft -= velocityX * 16;
        velocityX *= 0.94;
        momentumFrame = requestAnimationFrame(step);
      };

      momentumFrame = requestAnimationFrame(step);
    };

    carousel.addEventListener("pointerdown", e => {
      if (e.pointerType === "mouse" && e.button !== 0) return;
      if (e.target instanceof Element && e.target.closest(textSelector)) {
        setCursorFromTarget(e.target);
        return;
      }

      isDragging = true;
      velocityX = 0;
      lastClientX = e.clientX;
      lastTime = performance.now();

      carousel.setPointerCapture(e.pointerId);
      carousel.classList.add("active");
      carousel.style.cursor = "grabbing";
      previousBodyUserSelect = document.body.style.userSelect;
      document.body.style.userSelect = "none";
      stopMomentum();
    });

    carousel.addEventListener("pointermove", e => {
      if (!isDragging) return;

      const now = performance.now();
      const deltaX = e.clientX - lastClientX;
      const deltaTime = Math.max(now - lastTime, 1);

      carousel.scrollLeft -= deltaX;
      velocityX = deltaX / deltaTime;

      lastClientX = e.clientX;
      lastTime = now;
      e.preventDefault();
    });

    carousel.addEventListener("pointerover", e => {
      if (e.pointerType !== "mouse") return;
      setCursorFromTarget(e.target);
    });

    carousel.addEventListener("pointermove", e => {
      if (e.pointerType !== "mouse" || isDragging) return;
      setCursorFromTarget(e.target);
    });

    const endDrag = (pointerId: number) => {
      if (!isDragging) return;

      isDragging = false;
      carousel.classList.remove("active");
      carousel.style.cursor = "grab";
      document.body.style.userSelect = previousBodyUserSelect;
      if (carousel.hasPointerCapture(pointerId)) {
        carousel.releasePointerCapture(pointerId);
      }
      startMomentum();
    };

    carousel.addEventListener("pointerup", e => {
      endDrag(e.pointerId);
    });

    carousel.addEventListener("pointercancel", e => {
      endDrag(e.pointerId);
    });

    carousel.addEventListener("pointerleave", () => {
      if (!isDragging) {
        carousel.style.cursor = "grab";
      }
    });

    carousel.addEventListener("wheel", stopMomentum, { passive: true });

    carousel.addEventListener("dragstart", e => {
      e.preventDefault();
    });
  }
</script>
